Return-Path: <dev-bounces@lists.openshift.redhat.com>
X-Original-To: rick@rudelinux.org
Delivered-To: x10112648@homiemail-mx12.g.dreamhost.com
Received: from mx4-phx2.redhat.com (mx4-phx2.redhat.com [209.132.183.25])
	by homiemail-mx12.g.dreamhost.com (Postfix) with ESMTP id B1E3B2D4026
	for <rick@rudelinux.org>; Wed, 22 Jan 2014 21:54:25 -0800 (PST)
Received: from lists03.pubmisc.prod.ext.phx2.redhat.com (lists03.pubmisc.prod.ext.phx2.redhat.com [10.5.19.48])
	by mx4-phx2.redhat.com (8.13.8/8.13.8) with ESMTP id s0N5rwDo024660;
	Thu, 23 Jan 2014 00:53:59 -0500
Received: from int-mx02.intmail.prod.int.phx2.redhat.com
	(int-mx02.intmail.prod.int.phx2.redhat.com [10.5.11.12])
	by lists03.pubmisc.prod.ext.phx2.redhat.com (8.13.8/8.13.8) with ESMTP
	id s0N5ruQw007613
	for <dev-openshift@lists03.pubmisc.prod.ext.phx2.redhat.com>;
	Thu, 23 Jan 2014 00:53:56 -0500
Received: from mx1.redhat.com (ext-mx16.extmail.prod.ext.phx2.redhat.com
	[10.5.110.21])
	by int-mx02.intmail.prod.int.phx2.redhat.com (8.13.8/8.13.8) with ESMTP
	id s0N5ruLh006472
	for <dev-openshift@redhat.com>; Thu, 23 Jan 2014 00:53:56 -0500
Received: from int-mx09.intmail.prod.int.phx2.redhat.com
	(int-mx09.intmail.prod.int.phx2.redhat.com [10.5.11.22])
	by mx1.redhat.com (8.14.4/8.14.4) with ESMTP id s0N5rup8002962
	(version=TLSv1/SSLv3 cipher=DHE-RSA-AES256-SHA bits=256 verify=OK)
	for <dev@lists.openshift.redhat.com>; Thu, 23 Jan 2014 00:53:56 -0500
Received: from mx4-phx2.redhat.com (mx02.colomx.prod.int.phx2.redhat.com
	[10.5.7.2])
	by int-mx09.intmail.prod.int.phx2.redhat.com (8.14.4/8.14.4) with ESMTP
	id s0N5rtRu001239; Thu, 23 Jan 2014 00:53:55 -0500
Received: from zmail09.collab.prod.int.phx2.redhat.com
	(zmail09.collab.prod.int.phx2.redhat.com [10.5.83.11])
	by mx4-phx2.redhat.com (8.13.8/8.13.8) with ESMTP id s0N5rtGO024657;
	Thu, 23 Jan 2014 00:53:55 -0500
Subject: Re: Custom Cartridge Help (MariaDB Galera Cluster)
References: <CAD7dF9cKEnhQXCzntcKEiwQkDTUJgs8BixZs_tAw+OspboUOHQ@mail.gmail.com>
From: Clayton Coleman <ccoleman@redhat.com>
MIME-Version: 1.0
In-Reply-To: <CAD7dF9cKEnhQXCzntcKEiwQkDTUJgs8BixZs_tAw+OspboUOHQ@mail.gmail.com>
Message-Id: <444D4003-9206-4540-8138-57902AABE53B@redhat.com>
Date: Thu, 23 Jan 2014 00:53:55 -0500 (EST)
To: Andrew Lau <andrew@andrewklau.com>
Thread-Topic: Custom Cartridge Help (MariaDB Galera Cluster)
Thread-Index: Otral5o7ETPe20OXCYEPIomUIgpdRQ==
X-Scanned-By: MIMEDefang 2.67 on 10.5.11.12
X-Scanned-By: MIMEDefang 2.68 on 10.5.11.22
X-loop: dev@redhat.com
Cc: Diane Mueller-Klingspor <dmueller@redhat.com>,
        "dev@lists.openshift.redhat.com" <dev@lists.openshift.redhat.com>
X-BeenThere: dev@lists.openshift.redhat.com
X-Mailman-Version: 2.1.12
Precedence: junk
List-Id: Developer discussions around OpenShift and OpenShift Origin
	<dev.lists.openshift.redhat.com>
List-Unsubscribe: <http://lists.openshift.redhat.com/openshiftmm/options/dev>, 
	<mailto:dev-request@lists.openshift.redhat.com?subject=unsubscribe>
List-Archive: <http://lists.openshift.redhat.com/openshift-archives/dev>
List-Post: <mailto:dev@lists.openshift.redhat.com>
List-Help: <mailto:dev-request@lists.openshift.redhat.com?subject=help>
List-Subscribe: <http://lists.openshift.redhat.com/openshiftmm/listinfo/dev>, 
	<mailto:dev-request@lists.openshift.redhat.com?subject=subscribe>
Content-Type: multipart/mixed; boundary="===============4189479468222980928=="
Sender: dev-bounces@lists.openshift.redhat.com
Errors-To: dev-bounces@lists.openshift.redhat.com

--===============4189479468222980928==
Content-Type: multipart/alternative;
	boundary=Apple-Mail-E1DE12AA-17A8-4FDD-97F7-6572FD7B631E
Content-Transfer-Encoding: 7bit

--Apple-Mail-E1DE12AA-17A8-4FDD-97F7-6572FD7B631E
Content-Type: text/plain;
	charset=us-ascii
Content-Transfer-Encoding: quoted-printable



> On Jan 22, 2014, at 11:03 PM, Andrew Lau <andrew@andrewklau.com> wrote:
>=20
> Hi,
>=20
> I was dissecting my possibility of running a MariaDB Galera cluster within=
 OpenShift a few days ago, but I got stuck on a few things I was hoping some=
one could help me with:
>=20
> I started here if anyone is interested in helping https://github.com/andre=
wklau/openshift-galera-mariadb
>=20
> - Is there a way to have an environment variable of some sort which could l=
ist all the gears running? I would like to create the whole cartridge simila=
r to a web-app style so that it can scale infinitely. =46rom what I understa=
nd, environment variables set are global across all the gears upon first run=
, but does that mean they can be dynamically updated? I need this to write s=
ome logic to prevent a split brain. This is because the cluster requires the=
 first "gear" to be brought up with the slightly different command.=20

Currently the way to get this information is to use a connection hook (which=
 gives you variables from all of the gears) and then do the same configurati=
on on each gear.  If you look at the redis cart you can see an example of th=
e parsing of the data, although we'd like to make this simpler in the future=
 by piping JSON to the stdin of the hook.  For now, the example below demons=
trates breaking the info up and then using it to assign a master (the gear w=
ith the lowest alphabetical ordered uuid the first time the cluster starts u=
p).

https://github.com/smarterclayton/openshift-redis-cart/blob/master/hooks/set=
-redis-connection-info

>=20
> - Can anyone explain a little further on how the inter-gear networking wor=
ks? Looking at this post on Master-Slave it appears there doesn't seem to be=
 anything special required which is really confusing me about the whole mult=
i-tenancy concept https://www.openshift.com/blogs/cloudy-with-a-chance-of-da=
ta-master-slave-database-replication-on-openshift=20
>=20
> - Is it possible to use the haproxy routing to loadbalance the requests to=
 the cluster? I'm not so familiar with haproxy, but I'm assuming as it can r=
un like a tcp loadbalancer similar to LVS (which I currently use for my exte=
rnal cluster) I don't see why it couldn't work. It'd obviously need a custom=
 port?
>=20
> - I think I read somewhere, that by default the gears will try to do negat=
ive affinity by default when scaling out? eg. be hosted on a separate node. I=
s that the default behavior, or am I thinking of something else?
>=20
> - Am I wrong to assume this won't work with Online as it requires some ext=
ernal dependencies from the MariaDB repo (not SCL)?
>=20
> Any suggestions would be much appreciated.
>=20
> Thanks,
> Andrew.
> _______________________________________________
> dev mailing list
> dev@lists.openshift.redhat.com
> http://lists.openshift.redhat.com/openshiftmm/listinfo/dev

--Apple-Mail-E1DE12AA-17A8-4FDD-97F7-6572FD7B631E
Content-Type: text/html;
	charset=utf-8
Content-Transfer-Encoding: base64

PGh0bWw+PGhlYWQ+PG1ldGEgaHR0cC1lcXVpdj0iY29udGVudC10eXBlIiBjb250ZW50PSJ0ZXh0
L2h0bWw7IGNoYXJzZXQ9dXRmLTgiPjwvaGVhZD48Ym9keSBkaXI9ImF1dG8iPjxkaXY+PGJyPjwv
ZGl2PjxkaXY+PGJyPk9uIEphbiAyMiwgMjAxNCwgYXQgMTE6MDMgUE0sIEFuZHJldyBMYXUgJmx0
OzxhIGhyZWY9Im1haWx0bzphbmRyZXdAYW5kcmV3a2xhdS5jb20iPmFuZHJld0BhbmRyZXdrbGF1
LmNvbTwvYT4mZ3Q7IHdyb3RlOjxicj48YnI+PC9kaXY+PGJsb2NrcXVvdGUgdHlwZT0iY2l0ZSI+
PGRpdj48ZGl2IGRpcj0ibHRyIj48ZGl2IGNsYXNzPSJnbWFpbF9kZWZhdWx0IiBzdHlsZT0iZm9u
dC1mYW1pbHk6dGFob21hLHNhbnMtc2VyaWYiPjxkaXYgY2xhc3M9ImdtYWlsX2RlZmF1bHQiPkhp
LDwvZGl2PjxkaXYgY2xhc3M9ImdtYWlsX2RlZmF1bHQiPjxicj48L2Rpdj48ZGl2IGNsYXNzPSJn
bWFpbF9kZWZhdWx0Ij5JIHdhcyBkaXNzZWN0aW5nIG15IHBvc3NpYmlsaXR5IG9mIHJ1bm5pbmcg
YSBNYXJpYURCIEdhbGVyYSBjbHVzdGVyIHdpdGhpbiBPcGVuU2hpZnQgYSBmZXcgZGF5cyBhZ28s
IGJ1dCBJIGdvdCBzdHVjayBvbiBhIGZldyB0aGluZ3MgSSB3YXMgaG9waW5nIHNvbWVvbmUgY291
bGQgaGVscCBtZSB3aXRoOjwvZGl2Pg0KDQo8ZGl2IGNsYXNzPSJnbWFpbF9kZWZhdWx0Ij48YnI+
PC9kaXY+PGRpdiBjbGFzcz0iZ21haWxfZGVmYXVsdCI+SSBzdGFydGVkIGhlcmUgaWYgYW55b25l
IGlzIGludGVyZXN0ZWQgaW4gaGVscGluZyZuYnNwOzxhIGhyZWY9Imh0dHBzOi8vZ2l0aHViLmNv
bS9hbmRyZXdrbGF1L29wZW5zaGlmdC1nYWxlcmEtbWFyaWFkYiI+aHR0cHM6Ly9naXRodWIuY29t
L2FuZHJld2tsYXUvb3BlbnNoaWZ0LWdhbGVyYS1tYXJpYWRiPC9hPjwvZGl2Pg0KDQo8ZGl2IGNs
YXNzPSJnbWFpbF9kZWZhdWx0Ij48YnI+PC9kaXY+PGRpdiBjbGFzcz0iZ21haWxfZGVmYXVsdCI+
LSBJcyB0aGVyZSBhIHdheSB0byBoYXZlIGFuIGVudmlyb25tZW50IHZhcmlhYmxlIG9mIHNvbWUg
c29ydCB3aGljaCBjb3VsZCBsaXN0IGFsbCB0aGUgZ2VhcnMgcnVubmluZz8gSSB3b3VsZCBsaWtl
IHRvIGNyZWF0ZSB0aGUgd2hvbGUgY2FydHJpZGdlIHNpbWlsYXIgdG8gYSB3ZWItYXBwIHN0eWxl
IHNvIHRoYXQgaXQgY2FuIHNjYWxlIGluZmluaXRlbHkuIEZyb20gd2hhdCBJIHVuZGVyc3RhbmQs
IGVudmlyb25tZW50IHZhcmlhYmxlcyBzZXQgYXJlIGdsb2JhbCBhY3Jvc3MgYWxsIHRoZSBnZWFy
cyB1cG9uIGZpcnN0IHJ1biwgYnV0IGRvZXMgdGhhdCBtZWFuIHRoZXkgY2FuIGJlIGR5bmFtaWNh
bGx5IHVwZGF0ZWQ/IEkgbmVlZCB0aGlzIHRvIHdyaXRlIHNvbWUgbG9naWMgdG8gcHJldmVudCBh
IHNwbGl0IGJyYWluLiBUaGlzIGlzIGJlY2F1c2UgdGhlIGNsdXN0ZXIgcmVxdWlyZXMgdGhlIGZp
cnN0ICJnZWFyIiB0byBiZSBicm91Z2h0IHVwIHdpdGggdGhlIHNsaWdodGx5IGRpZmZlcmVudCBj
b21tYW5kLiZuYnNwOzwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PjwvYmxvY2txdW90ZT48ZGl2Pjxi
cj48L2Rpdj48ZGl2PkN1cnJlbnRseSB0aGUgd2F5IHRvIGdldCB0aGlzIGluZm9ybWF0aW9uIGlz
IHRvIHVzZSBhIGNvbm5lY3Rpb24gaG9vayAod2hpY2ggZ2l2ZXMgeW91IHZhcmlhYmxlcyBmcm9t
IGFsbCBvZiB0aGUgZ2VhcnMpIGFuZCB0aGVuIGRvIHRoZSBzYW1lIGNvbmZpZ3VyYXRpb24gb24g
ZWFjaCBnZWFyLiAmbmJzcDtJZiB5b3UgbG9vayBhdCB0aGUgcmVkaXMgY2FydCB5b3UgY2FuIHNl
ZSBhbiBleGFtcGxlIG9mIHRoZSBwYXJzaW5nIG9mIHRoZSBkYXRhLCBhbHRob3VnaCB3ZSdkIGxp
a2UgdG8gbWFrZSB0aGlzIHNpbXBsZXIgaW4gdGhlIGZ1dHVyZSBieSBwaXBpbmcgSlNPTiB0byB0
aGUgc3RkaW4gb2YgdGhlIGhvb2suICZuYnNwO0ZvciBub3csIHRoZSBleGFtcGxlIGJlbG93IGRl
bW9uc3RyYXRlcyBicmVha2luZyB0aGUgaW5mbyB1cCBhbmQgdGhlbiB1c2luZyBpdCB0byBhc3Np
Z24gYSBtYXN0ZXIgKHRoZSBnZWFyIHdpdGggdGhlIGxvd2VzdCBhbHBoYWJldGljYWwgb3JkZXJl
ZCB1dWlkIHRoZSBmaXJzdCB0aW1lIHRoZSBjbHVzdGVyIHN0YXJ0cyB1cCkuPC9kaXY+PGRpdj48
YnI+PC9kaXY+PGRpdj48YSBocmVmPSJodHRwczovL2dpdGh1Yi5jb20vc21hcnRlcmNsYXl0b24v
b3BlbnNoaWZ0LXJlZGlzLWNhcnQvYmxvYi9tYXN0ZXIvaG9va3Mvc2V0LXJlZGlzLWNvbm5lY3Rp
b24taW5mbyI+aHR0cHM6Ly9naXRodWIuY29tL3NtYXJ0ZXJjbGF5dG9uL29wZW5zaGlmdC1yZWRp
cy1jYXJ0L2Jsb2IvbWFzdGVyL2hvb2tzL3NldC1yZWRpcy1jb25uZWN0aW9uLWluZm88L2E+PC9k
aXY+PGJyPjxibG9ja3F1b3RlIHR5cGU9ImNpdGUiPjxkaXY+PGRpdiBkaXI9Imx0ciI+PGRpdiBj
bGFzcz0iZ21haWxfZGVmYXVsdCIgc3R5bGU9ImZvbnQtZmFtaWx5OnRhaG9tYSxzYW5zLXNlcmlm
Ij4NCg0KPGRpdiBjbGFzcz0iZ21haWxfZGVmYXVsdCI+PGJyPjwvZGl2PjxkaXYgY2xhc3M9Imdt
YWlsX2RlZmF1bHQiPi0gQ2FuIGFueW9uZSBleHBsYWluIGEgbGl0dGxlIGZ1cnRoZXIgb24gaG93
IHRoZSBpbnRlci1nZWFyIG5ldHdvcmtpbmcgd29ya3M/IExvb2tpbmcgYXQgdGhpcyBwb3N0IG9u
IE1hc3Rlci1TbGF2ZSBpdCBhcHBlYXJzIHRoZXJlIGRvZXNuJ3Qgc2VlbSB0byBiZSBhbnl0aGlu
ZyBzcGVjaWFsIHJlcXVpcmVkIHdoaWNoIGlzIHJlYWxseSBjb25mdXNpbmcgbWUgYWJvdXQgdGhl
IHdob2xlIG11bHRpLXRlbmFuY3kgY29uY2VwdCZuYnNwOzxhIGhyZWY9Imh0dHBzOi8vd3d3Lm9w
ZW5zaGlmdC5jb20vYmxvZ3MvY2xvdWR5LXdpdGgtYS1jaGFuY2Utb2YtZGF0YS1tYXN0ZXItc2xh
dmUtZGF0YWJhc2UtcmVwbGljYXRpb24tb24tb3BlbnNoaWZ0Ij5odHRwczovL3d3dy5vcGVuc2hp
ZnQuY29tL2Jsb2dzL2Nsb3VkeS13aXRoLWEtY2hhbmNlLW9mLWRhdGEtbWFzdGVyLXNsYXZlLWRh
dGFiYXNlLXJlcGxpY2F0aW9uLW9uLW9wZW5zaGlmdDwvYT4mbmJzcDs8L2Rpdj4NCg0KPGRpdiBj
bGFzcz0iZ21haWxfZGVmYXVsdCI+PGJyPjwvZGl2PjxkaXYgY2xhc3M9ImdtYWlsX2RlZmF1bHQi
Pi0gSXMgaXQgcG9zc2libGUgdG8gdXNlIHRoZSBoYXByb3h5IHJvdXRpbmcgdG8gbG9hZGJhbGFu
Y2UgdGhlIHJlcXVlc3RzIHRvIHRoZSBjbHVzdGVyPyBJJ20gbm90IHNvIGZhbWlsaWFyIHdpdGgg
aGFwcm94eSwgYnV0IEknbSBhc3N1bWluZyBhcyBpdCBjYW4gcnVuIGxpa2UgYSB0Y3AgbG9hZGJh
bGFuY2VyIHNpbWlsYXIgdG8gTFZTICh3aGljaCBJIGN1cnJlbnRseSB1c2UgZm9yIG15IGV4dGVy
bmFsIGNsdXN0ZXIpIEkgZG9uJ3Qgc2VlIHdoeSBpdCBjb3VsZG4ndCB3b3JrLiBJdCdkIG9idmlv
dXNseSBuZWVkIGEgY3VzdG9tIHBvcnQ/PC9kaXY+DQoNCjxkaXYgY2xhc3M9ImdtYWlsX2RlZmF1
bHQiPjxicj48L2Rpdj48ZGl2IGNsYXNzPSJnbWFpbF9kZWZhdWx0Ij4tIEkgdGhpbmsgSSByZWFk
IHNvbWV3aGVyZSwgdGhhdCBieSBkZWZhdWx0IHRoZSBnZWFycyB3aWxsIHRyeSB0byBkbyBuZWdh
dGl2ZSBhZmZpbml0eSBieSBkZWZhdWx0IHdoZW4gc2NhbGluZyBvdXQ/IGVnLiBiZSBob3N0ZWQg
b24gYSBzZXBhcmF0ZSBub2RlLiBJcyB0aGF0IHRoZSBkZWZhdWx0IGJlaGF2aW9yLCBvciBhbSBJ
IHRoaW5raW5nIG9mIHNvbWV0aGluZyBlbHNlPzwvZGl2Pg0KDQo8ZGl2IGNsYXNzPSJnbWFpbF9k
ZWZhdWx0Ij48YnI+PC9kaXY+PGRpdiBjbGFzcz0iZ21haWxfZGVmYXVsdCI+LSBBbSBJIHdyb25n
IHRvIGFzc3VtZSB0aGlzIHdvbid0IHdvcmsgd2l0aCBPbmxpbmUgYXMgaXQgcmVxdWlyZXMgc29t
ZSBleHRlcm5hbCBkZXBlbmRlbmNpZXMgZnJvbSB0aGUgTWFyaWFEQiByZXBvIChub3QgU0NMKT88
L2Rpdj48ZGl2IGNsYXNzPSJnbWFpbF9kZWZhdWx0Ij4NCg0KPGJyPjwvZGl2PjxkaXYgY2xhc3M9
ImdtYWlsX2RlZmF1bHQiPkFueSBzdWdnZXN0aW9ucyB3b3VsZCBiZSBtdWNoIGFwcHJlY2lhdGVk
LjwvZGl2PjxkaXYgY2xhc3M9ImdtYWlsX2RlZmF1bHQiPjxicj48L2Rpdj48ZGl2IGNsYXNzPSJn
bWFpbF9kZWZhdWx0Ij5UaGFua3MsPC9kaXY+PGRpdiBjbGFzcz0iZ21haWxfZGVmYXVsdCI+QW5k
cmV3LjwvZGl2PjwvZGl2Pg0KPC9kaXY+DQo8L2Rpdj48L2Jsb2NrcXVvdGU+PGJsb2NrcXVvdGUg
dHlwZT0iY2l0ZSI+PGRpdj48c3Bhbj5fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19f
X19fX19fX19fX19fXzwvc3Bhbj48YnI+PHNwYW4+ZGV2IG1haWxpbmcgbGlzdDwvc3Bhbj48YnI+
PHNwYW4+PGEgaHJlZj0ibWFpbHRvOmRldkBsaXN0cy5vcGVuc2hpZnQucmVkaGF0LmNvbSI+ZGV2
QGxpc3RzLm9wZW5zaGlmdC5yZWRoYXQuY29tPC9hPjwvc3Bhbj48YnI+PHNwYW4+PGEgaHJlZj0i
aHR0cDovL2xpc3RzLm9wZW5zaGlmdC5yZWRoYXQuY29tL29wZW5zaGlmdG1tL2xpc3RpbmZvL2Rl
diI+aHR0cDovL2xpc3RzLm9wZW5zaGlmdC5yZWRoYXQuY29tL29wZW5zaGlmdG1tL2xpc3RpbmZv
L2RldjwvYT48L3NwYW4+PGJyPjwvZGl2PjwvYmxvY2txdW90ZT48L2JvZHk+PC9odG1sPg==

--Apple-Mail-E1DE12AA-17A8-4FDD-97F7-6572FD7B631E--


--===============4189479468222980928==
Content-Type: text/plain; charset="us-ascii"
MIME-Version: 1.0
Content-Transfer-Encoding: 7bit
Content-Disposition: inline

_______________________________________________
dev mailing list
dev@lists.openshift.redhat.com
http://lists.openshift.redhat.com/openshiftmm/listinfo/dev

--===============4189479468222980928==--

